.. sectionauthor:: Maxim Dubinin <maxim.dubinin@nextgis.com>
.. NextGIS Toolbox TOC

.. _toolbox_intro:

Инструменты
===========


.. _toolbox_quadro:

Генератор набора квадратов
--------------------------

Это инструмент cоздает набор сеток квадратов (полигоны) и трансект их обхода для заданной территории.

На входе:

* x0 - Долгота точки привязки
* y0 - Широта точки привязки
* x1 - Долгота опорной точки
* y1 - Широта опорной точки
* size1 - Количество ячеек по первой оси
* size2 - Количество ячеек по второй оси
* side - Сторона генерации ячеек (right,left)
* base_interval - Размер стороны ячейки, метров

Алгоритм расчета: от точки привязки в направлении опорной точки прокладывается линия длиной равной size1*base_interval. От этой линии либо направо или налево от нее откладывается вторая линия длиной size2*base_interval, метров. Две эти линии формируют сетку квадратов.

Результатом работы процесса является набор слоёв:

* rect1 - сеть ячеек размером size1*size2 ячеек, центр первой ячейки - в точке привязки
* rect2 - сеть уменьшенных ячеек размером size1*size2 ячеек (т.е. в 4 раза больше ячеек, каждая крупная ячейка разделена на 4 части)
* line1 - линии обхода в направлении перпендикулярном линии представленной точкой привязки и опорной точкой
* line2 - линии обхода в направлении параллельном линии представленной точкой привязки и опорной точкой
* centers - центры ячеек сетки rect1

Запуск инструмента: https://toolbox.nextgis.com/operation/quadro

Скачать пример результатов: http://nextgis.ru/data/toolbox/quadro/outputs.zip

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4582/display?panel=layers

.. figure:: _static/quadro.png
   :align: center
   :width: 16cm
   
   Пример результата работы инструмента 


.. _toolbox_generalization:

Упрощение векторного слоя (генерализация)
-----------------------------------------

Упрощение объектов векторного слоя для уменьшения объема данных.

На входе:

* Векторный слой в формате ESRI Shape, заархивированный (zip)
* import_snap - 
* iterations - 
* method - метод упрощения, один из: 'douglas', 'douglas_reduction', 'lang', 'reduction', 'reumann', 'boyle', 'sliding_averaging', 'distance_weighting', 'chaiken', 'hermite', 'snakes', 'displacement'.
* threshold - порог упрощения (вводится в метрах)
* look_ahead - 
* reduction - 
* slide - 
* angle_thresh - 
* alpha - 
* beta - 

Результатом работы процесса является слой с упрощенными объектами (геометриями).

Запуск инструмента: https://toolbox.nextgis.com/operation/generalization

Скачать пример исходных данных и результата: https://demo.nextgis.com/api/resource/4548/export?zipped=true&format=shp

Посмотреть результат на интерактивной карте: https://demo.nextgis.com/resource/4108/display?panel=info

Подробнее о параметрах запуска: https://grasswiki.osgeo.org/wiki/V.generalize_tutorial

.. _toolbox_dem:

Пакет данных по рельефу
-----------------------
  
Генерация пакета данных по рельефу.

На входе:

* Шаг горизонталей. Целочисленное значение.
* База данных. Выбор из ALOS, GMTED, GEBCO.
* Граница обрезки. Подгрузка заархивированного в zip файла в формате GeoJSON (EPSG:4326).

Результатом работы процесса является набор слоёв:

* Изолинии рельефа с заданным шагом
* Цифровая модель рельефа (разрешение 30 м если территория до 60 гр. с.ш., 250 м если после)
* Свето-теневая отмывка рельефа (разрешение как у ЦМР)

Запуск инструмента: https://toolbox.nextgis.com/operation/dem

Скачать пример результатов: https://demo.nextgis.com/api/resource/4548/export?zipped=true&format=shp

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4108/display?panel=info

.. figure:: _static/isolines_sample.png
   :align: center
   :width: 16cm
   
   Пример рендеринга 

.. _toolbox_launch_conditions:


.. _toolbox_split_to_equal:

Разбить на равные части
-----------------------

На входе:

* Слой с полигоном (zip c Shapefile)

Результатом работы процесса является слой:

* Полигоны, с приблизительно одинаковой площадью

Запуск инструмента: https://toolbox.nextgis.com/operation/split_to_equal

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4552/display?panel=layers


Извлечение высот
----------------

Извлечение значений высот из ЦМР в точках. Возвращает CSV с координатами и высотами.

Запуск инструмента: https://toolbox.nextgis.com/operation/demInPoints

Лесис в SQLite
--------------

Преобразование базы данных Лесис (ГИС TopoL-L) в формат SQLite для открытия в NextGIS QGIS.

Запуск инструмента: https://toolbox.nextgis.com/operation/lesis2sqlite

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/lesis2sqlite/lesis.zip


.. _toolbox_eraser:

Удалить из целевого слоя
-----------------------   

   
Инструмент, позволяющий удалить из целевого слоя области объектов другого слоя.

На входе:

* Векторный слой, из которого нужно удалить области

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.

* Векторный слой, содержащий объекты, области которых нужно удалить из исходного

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.


Результатом работы инструмента является новый векторный слой.

Исходные векторные слои должны иметь одинаковую систему координат.

Запуск инструмента: https://toolbox.nextgis.com/operation/eraser

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/eraser/eraser.zip

Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4611/display?panel=info

.. figure:: _static/eraser.png
   :align: center
   :width: 16cm

   Пример результата работы инструмента



.. _toolbox_raster_calculator:

Калькулятор растров
-----------------------

.. figure:: _static/raster_calculator.png
   :align: center
   :width: 16cm
   
   
Инструмент, реализующий растровую арифметику для многоканальных растров или групп одноканальных растров.

На входе:

* Исходные растровые данные.

Исходные растровые данные могут быть представлены в двух видах:

1. многоканальный растр в GDAL-совместимом формате

2. ZIP архив с набором одноканальных GDAL-совместимых растров.

Растры в архиве могут храниться в разных системах координат, иметь разные охваты и размеры ячеек. При расчёте всё будет приведено в единый пространственный домен.

* Выражение.

Стандартное выражение с использованием операторов +, -, \*, /, >, < и т.п. Если исходные данные - ZIP архив, то следует использовать имена исходных файлов в выражении (например band4.tif / band5.tif, если файлы имеют соответствуюшие имена). Расширение является частью имени.
Для мультиканального растра следует использовать номер канала с префиксом & (например &4 / &5). Каналы нумеруются начиная с 1.

Примеры выражений:

Участки леса с температурой меньше 30 градусов:

forest_mask.tif * (land_temperature.tif < 30)


Индекс EVI:

2.5 * (&5 - &4) / (&5 + 6.0*&4 - 7.5*&2 + 1.0)


* Название результирующего растра

Без расширения файла (например ndvi, water). Расширение будет автоматически установлено в .tif

* Разрешение по X

Ширина каждого отдельного пикселя в результирующем растре в метрике системы координат первого растра из набора (напр. 30). Используйте символ - для автоматического подбора ширины пикселя

* Разрешение по Y

Высота каждого отдельного пикселя в результирующем растре в метрике системы координат первого растра из набора (напр. 30). Используйте символ - для автоматического подбора высоты пикселя

* Охват результирующего растра

Формат: xmin, ymin, xmax, ymax. Пример: 1000, 1000, 2500, 2500. Используйте - для автоматического определения охвата. В таком случае будет рассчитан охват пересечений всех входных растров

* Тип данных для нового растра

Доступные типы данных: Int32, Int16, Float64, UInt16, Byte, UInt32, Float32. Используйте - для автоматического подбора типа данных

Результатом работы процесса является одноканальный растр в формате GeoTiff, расчитанный в соответствии с заданным выражением.

Если пользователь задаёт один из опциональных параметров (разрешение по одной из осей или охват), то сначала все участвующие в выражении растры приводятся к заданному состоянию, затем производится расчёт. В случае автоматического подбора параметров пространственного домена используется следующая логика:

1. Вычисляется наименьшее пространственное разрешение среди всех исходных растров. Оно принимается за выходное.

2. Все растры перепроецируются в систему координат первого растра в списке.

3. Выходной охват вычисляется как охват пересечений всех исходных растров.



Запуск инструмента: https://toolbox.nextgis.com/operation/raster_calculator

Скачать пример исходных данных (многоканальный растр, 11 каналов, фрагмент сцены Landsat 8): http://nextgis.ru/data/toolbox/raster_calculator/LC08_B1_B11.TIF

Скачать пример исходных данных (архив с растрами, фрагменты сцены Landsat 8, доступные в выражении названия: band2.tif, band3.tif, band4.tif, band5.tif, band3_cropped.tif): http://nextgis.ru/data/toolbox/raster_calculator/LC08_20180530.zip

Скачать примеры результатов расчёта:

* Для примера с архивом (расчёт NDVI). Выражение: (band5.tif - band4.tif) / (band5.tif + band4.tif). Файл: http://nextgis.ru/data/toolbox/raster_calculator/ndvi.tif

* Для примера с многоканальным растром (маскирование участка реки). Выражение: ((&5 - &4) / (&5 + &4)) < -0.12. Файл: http://nextgis.ru/data/toolbox/raster_calculator/water_mask.tif


Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4566/display?panel=info


.. _toolbox_prepare_raster:

Подготовить растр
-----------------------
   
Инструмент, который осуществляет поканальную склейку набора одноканальных растров и обрезку склеенного растра по векторной маске.

На входе:

* Исходные растровые данные

Исходные растровые данные могут быть представлены в двух видах:

1. многоканальный растр в GDAL-совместимом формате

2. ZIP архив с набором одноканальных GDAL-совместимых растров.

* Векторный слой, используемый в качестве маски

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.

* Значение "Нет данных"

Значение, которое будет помечено как Нет данных. Используйте символ - для использования значения по умолчанию

* Название результирующего растра

Без расширения файла (например ndvi, water). Расширение будет автоматически установлено в .tif


Если на входе архив с одноканальными растрами, инструмент сначала объединяет их в многоканальный растр. Порядок каналов определяется алфавитной сортировкой имён исходных растров в архиве.
Затем многоканальный растр (собранный из архива или поданный на вход сразу) обрезается по векторной маске.


Исходные растры и векторная маска могут быть в разных системах координат, перед началом обработки все данные приводятся в единый пространственный домен.


Запуск инструмента: https://toolbox.nextgis.com/operation/prepare_raster

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/prepare_raster/prepare_raster.zip

Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4595/display?panel=info

.. figure:: _static/prepare_raster.png
   :align: center
   :width: 16cm

   Пример результата работы инструмента


.. _toolbox_landsat_to_radiance:

Радиометрическая калибровка данных Landsat
-----------------------
   
Инструмент осуществляет пересчёт сырых данных Landsat в интенсивность излучения (ToA Radiance).

На входе:

* Исходные файл канала Landsat

Файл из оригинального архива данных Landsat уровня обработки L1. Имя может быть любым. Данные могут быть предварительно обрезаны и т.д.

* Номер канала

Номер канала, соответствующего загруженному файлу. Обычно число, для ETM+ может быть также 6_VCID_1 и 6_VCID_2

* Файл метаданных Landsat

Текстовый файл из оригинального архива данных Landsat. В зависимости от типа данных, это файл \*MTL.txt или \*.MTL.


На выходе:

* Интенсивность излучения соответствующего канала в формате GeoTIFF



Радиометрическая калибровка необходима для анализа временных рядов, расчёта производных продуктов (например, индексных изображений).

Поддерживаются данные:

* Landsat 8 (OLI, TIRS)

* Landsat 7 (ETM+)

* Landsat 5 (TM)

* Landsat 4 (TM)


Запуск инструмента: https://toolbox.nextgis.com/operation/landsat_to_radiance

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/landsat_to_radiance/landsat_to_radiance.zip

.. _toolbox_landsat_to_reflectance:

Расчёт спектрального альбедо объектов по данным Landsat
-----------------------
   
Инструмент осуществляет пересчёт интенсивности излучения (ToA Radiance) данных Landsat в отражательную способность с возможностью применения атмосферной коррекции по методу DOS

На входе:

* Файл с интенсивностью излучения одного из каналов Landsat

Результат радиометрической калибовки исходных данных Landsat, например с помощью инструмента https://toolbox.nextgis.com/operation/landsat_to_radiance

* Номер канала

Номер канала, соответствующего загруженному файлу. Обычно число, для ETM+ может быть также 6_VCID_1 и 6_VCID_2

* Файл метаданных Landsat

Текстовый файл из оригинального архива данных Landsat. В зависимости от типа данных, это файл \*MTL.txt или \*.MTL.

* Тип результата обработки

0 для расчёта альбедо по умолчанию, 1 для применения атмосферной коррекции по методу DOS


На выходе:

* Спектральное альбедо соответствующего канала в формате GeoTIFF


Спектральное альбедо - основной тип информации, который следует использовать при анализе данных дистанционного зондирования. Он лучше всего подходит для анализа временных рядов. Возможность применения атмосферной коррекции также улучшает качество данных.

Поддерживаются данные:

* Landsat 8 (OLI, TIRS)

* Landsat 7 (ETM+)

* Landsat 5 (TM)

* Landsat 4 (TM)


Запуск инструмента: https://toolbox.nextgis.com/operation/landsat_to_reflectance

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/landsat_to_reflectance/landsat_to_reflectance.zip

.. _toolbox_ndi:

Расчёт нормализованного разностного индекса
-----------------------
   
Инструмент осуществляет расчёт нормализованного разностного индекса для двух любых входных изображений.

На входе:

* Растровое изображение - первый участник разностного индекса

Любой GDAL-совместимый растр

* Растровое изображение - второй участник разностного индекса

Любой GDAL-совместимый растр


На выходе:

* Растр с нормализованных разностным индексом в формате GeoTiff.


Расчёт осуществляется по формуле: (Первое изображение - Второе изображение) / (Первое изображение + Второе изображение). Значения пикселей результирующего растра находятся в диапазоне от -1 до 1
Перед расчётом оба изображения приводятся в единый пространственный домен. Используется проекция и пространственное разрешение первого растра.


Примеры распространенных нормализованных разностных индексов:

* NDVI - для оценки растительности (первый растр - съемка в ближнем инфракрасном диапазоне, второй - в красном диапазоне длин волн)  Для данных Landsat 8: 5 и 4 каналы.
* NDWI - для обнаружения водных объектов (первый растр - съемка в ближнем инфракрасном диапазоне, второй - в среднем инфракрасном диапазоне длин волн). Для данных Landsat 8: 5 и 6 каналы.
* NDSI - для оценки снежного покрова (первый растр - съёмка в зеленом диапазоне, второй - в среднем инфракрасном диапазоне длин волн). Для данных Landsat 8: 3 и 6 каналы.

Запуск инструмента: https://toolbox.nextgis.com/operation/ndi

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/ndi/ndi.zip

  
 
Объединение векторных слоёв
-----------------------
   
   
.. figure:: _static/ogrmerge.png
   :align: center
   :width: 16cm

   Исходные и результирующие данные
   
   
Инструмент осуществляет объединение множества векторных слоёв в один слой.

На входе:

* Архив в формате ZIP с файлами формата .shp, .geojson, .gpkg, .tab

На выходе:

* Файл в формате GeoPackage с результатом объединения.


В инструменте нет ограничения на количество исходных слоёв. Они склеиваются по-очереди. Название исходного слоя не сохраняется.

Запуск инструмента: https://toolbox.nextgis.com/operation/ogrmerge

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/ogrmerge/ogrmerge.zip



 
Дублировать структуру векторного слоя nextgis.com
---------------------------------------------------------
   
   
.. figure:: _static/ogrmerge.png
   :align: center
   :width: 16cm

   Исходные и результирующие данные
   
   
Инструмент осуществляет дублирование структуры векторного слоя nextgis.com в другой каталог или инстанс. Копируются названия полей, порядок полей, типы полей, псевдонимы и описания. Метаданные в текущей версии не копируются.

На входе:

*  Две пары URL, логинов и паролей, id исходного слоя и id новой папк

На выходе:

* Выходных данных нет, результатом является создание слоя в nextgis.com

Особенности: 
Пригоден для слоёв создаваемых NextGIS FormBuilder. Используется при процессе репликации слоёв. Данные не копируются.


Запуск инструмента: https://toolbox.nextgis.com/operation/ngw_copy_layer

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/ngw_copy_layer/ngw_copy_layer.zip



