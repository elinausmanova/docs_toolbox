.. sectionauthor:: Maxim Dubinin <maxim.dubinin@nextgis.com>
.. NextGIS Toolbox TOC

.. _toolbox_intro:

Инструменты
===========


.. _toolbox_quadro:

Генератор набора квадратов
--------------------------

Это инструмент cоздает набор сеток квадратов (полигоны) и трансект их обхода для заданной территории.

На входе:

* x0 - Долгота точки привязки
* y0 - Широта точки привязки
* x1 - Долгота опорной точки
* y1 - Широта опорной точки
* size1 - Количество ячеек по первой оси
* size2 - Количество ячеек по второй оси
* side - Сторона генерации ячеек (right,left)
* base_interval - Размер стороны ячейки, метров

Алгоритм расчета: от точки привязки в направлении опорной точки прокладывается линия длиной равной size1*base_interval. От этой линии либо направо или налево от нее откладывается вторая линия длиной size2*base_interval, метров. Две эти линии формируют сетку квадратов.

Результатом работы процесса является набор слоёв:

* rect1 - сеть ячеек размером size1*size2 ячеек, центр первой ячейки - в точке привязки
* rect2 - сеть уменьшенных ячеек размером size1*size2 ячеек (т.е. в 4 раза больше ячеек, каждая крупная ячейка разделена на 4 части)
* line1 - линии обхода в направлении перпендикулярном линии представленной точкой привязки и опорной точкой
* line2 - линии обхода в направлении параллельном линии представленной точкой привязки и опорной точкой
* centers - центры ячеек сетки rect1

Запуск инструмента: https://toolbox.nextgis.com/operation/quadro

Скачать пример результатов: http://nextgis.ru/data/toolbox/quadro/outputs.zip

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4582/display?panel=layers

.. figure:: _static/quadro.png
   :align: center
   :width: 16cm
   
   Пример результата работы инструмента 


.. _toolbox_generalization:

Упрощение векторного слоя
-------------------------

Упрощение объектов векторного слоя для уменьшения объема данных.

На входе:

* Векторный слой в формате ESRI Shape, заархивированный (zip)
* import_snap - 
* iterations - 
* method - метод упрощения, выбор из [douglas]
* threshold - порог упрощения (вводится в метрах)
* look_ahead - 
* reduction - 
* slide - 
* angle_thresh - 
* alpha - 
* beta - 

Результатом работы процесса является слой с упрощенными объектами (геометриями).

Запуск инструмента: https://toolbox.nextgis.com/operation/generalization

Скачать пример исходных данных и результата: https://demo.nextgis.com/api/resource/4548/export?zipped=true&format=shp

Посмотреть результат на интерактивной карте: https://demo.nextgis.com/resource/4108/display?panel=info

.. _toolbox_dem:

Пакет данных по рельефу
-----------------------
  
Генерация пакета данных по рельефу.

На входе:

* Шаг горизонталей. Целочисленное значение.
* База данных. Выбор из ALOS, GMTED, GEBCO.
* Граница обрезки. Подгрузка заархивированного в zip файла в формате GeoJSON (EPSG:4326).

Результатом работы процесса является набор слоёв:

* Изолинии рельефа с заданным шагом
* Цифровая модель рельефа (разрешение 30 м если территория до 60 гр. с.ш., 250 м если после)
* Свето-теневая отмывка рельефа (разрешение как у ЦМР)

Запуск инструмента: https://toolbox.nextgis.com/operation/dem

Скачать пример результатов: https://demo.nextgis.com/api/resource/4548/export?zipped=true&format=shp

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4108/display?panel=info

.. figure:: _static/isolines_sample.png
   :align: center
   :width: 16cm
   
   Пример рендеринга 

.. _toolbox_launch_conditions:


.. _toolbox_split_to_equal:

Разбить на равные части
-----------------------

На входе:

* Слой с полигоном (zip c Shapefile)

Результатом работы процесса является слой:

* Полигоны, с приблизительно одинаковой площадью

Запуск инструмента: https://toolbox.nextgis.com/operation/split_to_equal

Посмотреть результаты на интерактивной карте: https://demo.nextgis.com/resource/4552/display?panel=layers


Извлечение высот
----------------

Извлечение значений высот из ЦМР в точках. Возвращает CSV с координатами и высотами.

Запуск инструмента: https://toolbox.nextgis.com/operation/demInPoints


.. _toolbox_eraser:

Удалить из целевого слоя
-----------------------   

   
Инструмент, позволяющий удалить из целевого слоя области объектов другого слоя.

На входе:

* Векторный слой, из которого нужно удалить области

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.

* Векторный слой, содержащий объекты, области которых нужно удалить из исходного

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.


Результатом работы инструмента является новый векторный слой.

Исходные векторные слои должны иметь одинаковую систему координат.

Запуск инструмента: https://toolbox.nextgis.com/operation/eraser

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/eraser/eraser.zip

Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4611/display?panel=info

.. figure:: _static/eraser.png
   :align: center
   :width: 16cm

   Пример результата работы инструмента



.. _toolbox_raster_calculator:

Калькулятор растров
-----------------------

.. figure:: _static/raster_calculator.png
   :align: center
   :width: 16cm
   
   
Инструмент, реализующий растровую арифметику для многоканальных растров или групп одноканальных растров.

На входе:

* Исходные растровые данные.

Исходные растровые данные могут быть представлены в двух видах:

1. многоканальный растр в GDAL-совместимом формате

2. ZIP архив с набором одноканальных GDAL-совместимых растров.

Растры в архиве могут храниться в разных системах координат, иметь разные охваты и размеры ячеек. При расчёте всё будет приведено в единый пространственный домен.

* Выражение.

Стандартное выражение с использованием операторов +, -, \*, /, >, < и т.п. Если исходные данные - ZIP архив, то следует использовать имена исходных файлов в выражении (например band4.tif / band5.tif, если файлы имеют соответствуюшие имена). Расширение является частью имени.
Для мультиканального растра следует использовать номер канала с префиксом & (например &4 / &5). Каналы нумеруются начиная с 1.

Примеры выражений:

Участки леса с температурой меньше 30 градусов:

forest_mask.tif * (land_temperature.tif < 30)


Индекс EVI:

2.5 * (&5 - &4) / (&5 + 6.0*&4 - 7.5*&2 + 1.0)


* Название результирующего растра

Без расширения файла (например ndvi, water). Расширение будет автоматически установлено в .tif

* Разрешение по X

Ширина каждого отдельного пикселя в результирующем растре в метрике системы координат первого растра из набора (напр. 30). Используйте символ - для автоматического подбора ширины пикселя

* Разрешение по Y

Высота каждого отдельного пикселя в результирующем растре в метрике системы координат первого растра из набора (напр. 30). Используйте символ - для автоматического подбора высоты пикселя

* Охват результирующего растра

Формат: xmin, ymin, xmax, ymax. Пример: 1000, 1000, 2500, 2500. Используйте - для автоматического определения охвата. В таком случае будет рассчитан охват пересечений всех входных растров

* Тип данных для нового растра

Доступные типы данных: Int32, Int16, Float64, UInt16, Byte, UInt32, Float32. Используйте - для автоматического подбора типа данных

Результатом работы процесса является одноканальный растр в формате GeoTiff, расчитанный в соответствии с заданным выражением.

Если пользователь задаёт один из опциональных параметров (разрешение по одной из осей или охват), то сначала все участвующие в выражении растры приводятся к заданному состоянию, затем производится расчёт. В случае автоматического подбора параметров пространственного домена используется следующая логика:

1. Вычисляется наименьшее пространственное разрешение среди всех исходных растров. Оно принимается за выходное.

2. Все растры перепроецируются в систему координат первого растра в списке.

3. Выходной охват вычисляется как охват пересечений всех исходных растров.



Запуск инструмента: https://toolbox.nextgis.com/operation/raster_calculator

Скачать пример исходных данных (многоканальный растр, 11 каналов, фрагмент сцены Landsat 8): http://nextgis.ru/data/toolbox/raster_calculator/LC08_B1_B11.TIF

Скачать пример исходных данных (архив с растрами, фрагменты сцены Landsat 8, доступные в выражении названия: band2.tif, band3.tif, band4.tif, band5.tif, band3_cropped.tif): http://nextgis.ru/data/toolbox/raster_calculator/LC08_20180530.zip

Скачать примеры результатов расчёта:

* Для примера с архивом (расчёт NDVI). Выражение: (band5.tif - band4.tif) / (band5.tif + band4.tif). Файл: http://nextgis.ru/data/toolbox/raster_calculator/ndvi.tif

* Для примера с многоканальным растром (маскирование участка реки). Выражение: ((&5 - &4) / (&5 + &4)) < -0.12. Файл: http://nextgis.ru/data/toolbox/raster_calculator/water_mask.tif


Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4566/display?panel=info


.. _toolbox_prepare_raster:

Подготовить растр
-----------------------
   
Инструмент, который осуществляет поканальную склейку набора одноканальных растров и обрезку склеенного растра по векторной маске.

На входе:

* Исходные растровые данные

Исходные растровые данные могут быть представлены в двух видах:

1. многоканальный растр в GDAL-совместимом формате

2. ZIP архив с набором одноканальных GDAL-совместимых растров.

* Векторный слой, используемый в качестве маски

ZIP-архив с ESRI Shapefile или отдельный файл формата поддерживаемого OGR.

* Значение "Нет данных"

Значение, которое будет помечено как Нет данных. Используйте символ - для использования значения по умолчанию

* Название результирующего растра

Без расширения файла (например ndvi, water). Расширение будет автоматически установлено в .tif


Если на входе архив с одноканальными растрами, инструмент сначала объединяет их в многоканальный растр. Порядок каналов определяется алфавитной сортировкой имён исходных растров в архиве.
Затем многоканальный растр (собранный из архива или поданный на вход сразу) обрезается по векторной маске.


Исходные растры и векторная маска могут быть в разных системах координат, перед началом обработки все данные приводятся в единый пространственный домен.


Запуск инструмента: https://toolbox.nextgis.com/operation/prepare_raster

Скачать пример исходных данных и результатов расчёта: http://nextgis.ru/data/toolbox/prepare_raster/prepare_raster.zip

Посмотреть исходные данные и результаты расчётов на интерактивной карте: https://demo.nextgis.com/resource/4595/display?panel=info

.. figure:: _static/prepare_raster.png
   :align: center
   :width: 16cm

   Пример результата работы инструмента

.. _toolbox_generalization:

Генерализация
-----------------------
   
Инструмент упрощения геометрий векторных объектов (генерализация).

На входе:

* Исходные векторные данные
* Параметры алгоритма:
  - метод генерализации (один из: 'douglas', 'douglas_reduction', 'lang', 'reduction', 'reumann', 'boyle', 'sliding_averaging', 'distance_weighting', 'chaiken', 'hermite', 'snakes', 'displacement').
  - параметры, применяемые к методу.
  
